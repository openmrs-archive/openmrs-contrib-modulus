MODULUS
=====
 [![OpenMRS Talk](https://omrs-shields.psbrandt.io/custom/openmrs/talk/F26522?logo=openmrs)](http://talk.openmrs.org/c/projects/modulus)
 [![OpenMRS IRC](https://img.shields.io/badge/openmrs-irc-EEA616.svg?logo=data%3Aimage%2Fsvg%2Bxml%3Bbase64%2CPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MTIiIGhlaWdodD0iNjEyIiB2aWV3Qm94PSIwIDAgNjEyIDYxMiI%2BPHBhdGggZD0iTTE1MyAyMjkuNWMtMjEuMTMzIDAtMzguMjUgMTcuMTE3LTM4LjI1IDM4LjI1UzEzMS44NjcgMzA2IDE1MyAzMDZjMjEuMTE0IDAgMzguMjUtMTcuMTE3IDM4LjI1LTM4LjI1UzE3NC4xMzMgMjI5LjUgMTUzIDIyOS41em0xNTMgMGMtMjEuMTMzIDAtMzguMjUgMTcuMTE3LTM4LjI1IDM4LjI1UzI4NC44NjcgMzA2IDMwNiAzMDZjMjEuMTE0IDAgMzguMjUtMTcuMTE3IDM4LjI1LTM4LjI1UzMyNy4xMzMgMjI5LjUgMzA2IDIyOS41em0xNTMgMGMtMjEuMTMzIDAtMzguMjUgMTcuMTE3LTM4LjI1IDM4LjI1UzQzNy44NjcgMzA2IDQ1OSAzMDZzMzguMjUtMTcuMTE3IDM4LjI1LTM4LjI1UzQ4MC4xMzMgMjI5LjUgNDU5IDIyOS41ek0zMDYgMEMxMzcuMDEyIDAgMCAxMTkuODc1IDAgMjY3Ljc1YzAgODQuNTE0IDQ0Ljg0OCAxNTkuNzUgMTE0Ljc1IDIwOC44MjZWNjEybDEzNC4wNDctODEuMzRjMTguNTUyIDMuMDYyIDM3LjYzOCA0Ljg0IDU3LjIwMyA0Ljg0IDE2OS4wMDggMCAzMDYtMTE5Ljg3NSAzMDYtMjY3Ljc1UzQ3NS4wMDggMCAzMDYgMHptMCA0OTcuMjVjLTIyLjMzOCAwLTQzLjkxLTIuNi02NC42NDMtNy4wMmwtOTAuMDQgNTQuMTI0IDEuMjA0LTg4LjdDODMuNSA0MTQuMTMzIDM4LjI1IDM0NS41MTMgMzguMjUgMjY3Ljc1YzAtMTI2Ljc0IDExOS44NzUtMjI5LjUgMjY3Ljc1LTIyOS41czI2Ny43NSAxMDIuNzYgMjY3Ljc1IDIyOS41UzQ1My44NzUgNDk3LjI1IDMwNiA0OTcuMjV6IiBmaWxsPSIjZmZmIi8%2BPC9zdmc%2B)](http://irc.openmrs.org)
 [![OpenMRS Telegram](https://img.shields.io/badge/openmrs-telegram-009384.svg?logo=data%3Aimage%2Fsvg%2Bxml%3Bbase64%2CPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNDAgMjQwIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImEiIHgxPSIuNjY3IiB5MT0iLjE2NyIgeDI9Ii40MTciIHkyPSIuNzUiPjxzdG9wIHN0b3AtY29sb3I9IiMzN2FlZTIiIG9mZnNldD0iMCIvPjxzdG9wIHN0b3AtY29sb3I9IiMxZTk2YzgiIG9mZnNldD0iMSIvPjwvbGluZWFyR3JhZGllbnQ%2BPGxpbmVhckdyYWRpZW50IGlkPSJiIiB4MT0iLjY2IiB5MT0iLjQzNyIgeDI9Ii44NTEiIHkyPSIuODAyIj48c3RvcCBzdG9wLWNvbG9yPSIjZWZmN2ZjIiBvZmZzZXQ9IjAiLz48c3RvcCBzdG9wLWNvbG9yPSIjZmZmIiBvZmZzZXQ9IjEiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48Y2lyY2xlIGN4PSIxMjAiIGN5PSIxMjAiIHI9IjEyMCIgZmlsbD0idXJsKCNhKSIvPjxwYXRoIGZpbGw9IiNjOGRhZWEiIGQ9Ik05OCAxNzVjLTMuODg4IDAtMy4yMjctMS40NjgtNC41NjgtNS4xN0w4MiAxMzIuMjA3IDE3MCA4MCIvPjxwYXRoIGZpbGw9IiNhOWM5ZGQiIGQ9Ik05OCAxNzVjMyAwIDQuMzI1LTEuMzcyIDYtM2wxNi0xNS41NTgtMTkuOTU4LTEyLjAzNSIvPjxwYXRoIGZpbGw9InVybCgjYikiIGQ9Ik0xMDAuMDQgMTQ0LjQxbDQ4LjM2IDM1LjczYzUuNTIgMy4wNDQgOS41IDEuNDY3IDEwLjg3Ni01LjEyNGwxOS42ODUtOTIuNzYzYzIuMDE2LTguMDgtMy4wOC0xMS43NDYtOC4zNTgtOS4zNWwtMTE1LjU5IDQ0LjU3MmMtNy44OSAzLjE2NS03Ljg0NCA3LjU2Ny0xLjQ0IDkuNTI4bDI5LjY2NCA5LjI2IDY4LjY3My00My4zMjZjMy4yNC0xLjk2NiA2LjIxNy0uOTEgMy43NzUgMS4yNTgiLz48L3N2Zz4%3D)](https://telegram.me/openmrs)


A repository of add-ons for the [OpenMRS platform](https://wiki.openmrs.org/x/RAEr). This repository contains the backend of the OpenMRS Modules directory at [http://modules.openmrs.org](http://modules.openmrs.org).


QUICK LINKS
-----

**API Documentation**: [Browse the API Docs][]

**Frontend UI Application**: [Modulus UI][]

**Design and Discussion**: [Modulus on OpenMRS Talk][]

**Dev Environment Setup Guide**: [How to install Modulus and Modulus UI][guide] (covers setting up a Modulus server, OpenMRS ID OAuth, and the Modulus UI frontend)

-----

Modulus provides a data model and a REST API for representing OpenMRS modules. [Modulus UI] is developed separately, and provides the front-end web application that consumes this REST api.

Building
-----

To prepare a dev environment:

1. Build requirements: MySQL, Java EE JDK 7. **As of early 2016, only JDK 7 is supported. We'll need to update our version of Grails to move to JDK 8.** **You may experience problems running on a server with less than 2GB RAM.**
2. Install **Grails 2.3.7**. [sdkman][] is the simplest way:
       
        $ sdk install grails 2.3.7

3. Clone this repo and its submodules:

        $ git clone https://github.com/openmrs/openmrs-contrib-modulus.git
        $ cd openmrs-contrib-modulus
        $ git submodule init
        $ git submodule update
        
4. Create a MySQL database:

        $ mysql -u root -p -e "CREATE DATABASE modulus"

5. Configure Modulus. Modulus looks for config files in `~/.grails/modulus-config.groovy`, `/opt/modulus/modulus-config.groovy`, or in the classpath. It will also look for `.properties` files in the same locations. Custom config locations can be passed with `-Dmodulus.config.location=CONFIG_PATH` as a run argument. See example config file below.

6. Run grails. The final command will start a dev server:

        $ grails clean
        $ grails refresh-dependencies
        $ grails run-app
        
**NOTE:** Modulus only provides the back-end and REST API of the OpenMRS Modules application. To get an actual web interface for Modulus, build and install [Modulus UI][].
        
[sdkman]: http://sdkman.io/
[Modulus-UI]: https://github.com/openmrs/openmrs-contrib-modulus-ui

OAuth
-----

To sign in to Modulus and Modulus-UI, you need an OAuth key with an [OpenMRS ID](https://github.com/openmrs/openmrs-contrib-id) server. You can set up a local ID server, or [request a key from the server at id.openmrs.org](http://om.rs/oauthrequest).

Once you have this key, add it to your `modulus-config.groovy` file via the `oauth.providers.openmrsid` object. See example below:

Example `modulus-config.groovy`:
-----

```groovy
import org.openmrs.modulus.oauth.OpenMrsIdApi

grails.serverURL = "http://localhost:8080"
modulus {
       uploadDestionation = "/tmp/uploads"
       openmrsid.hostname = "https://id.openmrs.org"
}

// Overrides the default configuration in grails-app/conf/DataSource.groovy
dataSource.url = "jdbc:mysql://localhost/modulus"
dataSource.username = "root"
dataSource.password = ""

// OpenMRS ID Provider. These keys correspond to keys issued by your OpenMRS ID server.
oauth.providers.openmrsid = [
        api: OpenMrsIdApi,
        key: "YOUR_OAUTH_APPLICATION_KEY",
        secret: "YOUR_OAUTH_SECRET",
        successUri: "${grails.serverURL}/login/success",
        failureUri: "${grails.serverURL}/login/failure",
        callback: "${grails.serverURL}/oauth/openmrsid/callback",
        scope: "profile"
]

// Modulus UI Client. These keys must be known by a Modulus UI client to connect.
grails.plugin.springsecurity.oauthProvider.clients = [
        [
                clientId: "modulus123",
                clientSecret: "modulus123",
                registeredRedirectUri: ["http://localhost:8083/auth-success.html"],
                additionalInformation: [
                        name: "Dev Modulus UI",
                        preApproved: true
                ]
        ]
]
```





Project Resources
-----

- Design and discussion: [Modulus on OpenMRS Talk][]
- Issue tracking: [Modulus on OpenMRS JIRA][]
- Continuous Integration / Deployment: [Modulus on OpenMRS CI][]
- Wiki Page: [OpenMRS Modules][]

[Modulus on OpenMRS Talk]: https://talk.openmrs.org/category/projects/modulus
[Modulus on OpenMRS JIRA]: https://tickets.openmrs.org/browse/MOD
[Modulus on OpenMRS CI]: https://ci.openmrs.org/browse/MOD-ULUS
[OpenMRS Modules]: http://go.openmrs.org/modulerepositoryproject
[Modulus UI]: https://github.com/openmrs/openmrs-contrib-modulus-ui
[Browse the API Docs]: https://openmrs.github.io/openmrs-contrib-modulus/
[guide]: https://wiki.openmrs.org/x/R5K-B
